# 存储管理

因为程序运行需要数据，在内存中需要一定的空间来存储这些数据

## 固定存储分配

整存整取，程序多大，就直接分配多大的内存空间。

但是现在程序都非常大，这样分配很容易造成内存溢出，基本上不使用这样的存储管理方式了

## 分页存储管理

本质上也是固定存储分配，但不是整存整取

在逻辑上将程序分成若干个大小相同的逻辑页，对应于物理上的内存空间的物理块

逻辑页由页号和页内地址组成，不一定是32位的，根据实际情况，页号加页内地址就是逻辑地址

物理块由物理块号和物理偏移地址组成，物理偏移地址就是页内地址，两者相同，但是物理块号并不等于页号，由页表确定对应关系。物理块号加物理偏移地址就是物理地址

具体的转换关系如下

![](http://cdn.frankjoey.com//img2/202210281512492.png)

这种方式是边运行边加载，就不需要有特别的内存空间就可以运行一个比较大的程序。
这是应用了局部性原理，依据时间局部性和空间局部性把一部分数据存在内存

### 页面置换算法

内存的空间不是固定的，所以内存一定会有被占满的时候，当内存满了之后，在运行别的程序，就需要置换存在内存中的现有的页面

#### 最优算法

是一种理论上的算法，不可能实现。通常被用来判断其他算法的性能。
原理是选择未来最长时间内不被访问的页面被置换

#### 先进先出算法

即最先存入内存的页面，最先被置换。但是效率不高，容易出现抖动现象。比如一个程序需要帧数较多，加载的页面很多，这是置换了一些页面就会出现抖动

#### 最近最少访问

在最近的过去，被最少访问的页面优先被置换，避免了抖动现象

#### 淘汰原则

先淘汰最近未被访问的页面，如果都被访问了，则优先淘汰最近未被修改的页面

### 快表

本质上也是一种页表，存储在cache中，只存储少数访问频率高的页面页号与物理块号对应关系

相对于快表之所以更快是因为少访问依次主存

普通页表存在主存中，需要先访问一次主存获取到对应的物理块号，拼接成物理地址后，再根据这个地址去访问一次主存。总共访问两次主存

快表则在获取物理块号时访问的是cache，提高了访问速度

## 分段存储管理

分段存储管理与分页存储管理类似，将程序分成一个个段，不同的是每段的大小不同，是按照逻辑上的功能分的，这样就不能只靠段号和段内地址就确定物理地址了，还需要每段的长度。

逻辑地址对应物理地址的方式如下：

![](http://cdn.frankjoey.com//img2/202210281632129.png)


# 设备管理

## I/O技术

访问硬盘上文件的过程

1. 设备发出一个请求
2. 有用户进程来处理这个请求
3. 设备无关软件检查是否在cache中存在数据，如果存在就说明已经打开。通常是不存在，然后进行下一步
4. 设备驱动程序来打开文件
5. 中断处理程序，cpu中断当前正在执行的事情
6. 硬件，cpu访问这个文件
7. 然后再一步步返回，告诉设备处理结果
   
流程图如下

![](http://cdn.frankjoey.com//img2/202210281826287.png)

# 文件管理

## 索引文件结构

由索引节点最终找到物理盘块

### 直接索引节点

索引节点中存储的直接是物理盘块的内容，假设有10个节点，每个物理盘块内容有1kb，那么功能存储10kb数据

### 一级间接索引节点

索引节点中存储的是物理盘块的地址，相对来说地址占得空间更小，能够索引的数据更多。根据上条假设，一个索引节点空间为1kb，假设一个地址占空间1b，那么一个节点能存1000个地址，也就是1000kb数据，比之前存储的数据量大了1000倍

### 二级间接索引节点

索引节点中存储的是一级地址，一级间接索引节点又存储了物理盘块的地址，这样又成倍地增加了存储的数据量

### 画图表示索引节点

![](http://cdn.frankjoey.com//img2/202210281851906.png)

### 直接地址索引和直接索引

直接地址索引并不等于直接索引，直接地址索引存的物理盘块的地址，直接索引存的就是物理盘块的内容，这种情况下，直接地址索引就相当于一级间接索引

### 逻辑块号和物理块号

索引节点中存的地址是物理块号，逻辑块号是从0开始自己编写的。找逻辑块号对应的物理块号，需要知道一个索引节点存多少个地址，才能找到对应的逻辑块号是在哪个位置。前提是需要知道索引块和物理块的大小，一个地址的大小，这样一个索引节点能放多少个地址就知道了

## 文件目录

### 绝对路径

从根目录开始的路径，不带文件名

第一个\代表根目录，不能省掉，最后一个\可要可不要

### 相对路径

从当前目录开始的路径，不带文件名
可以不要第一个\，最后一个\可要可不要

### 完整路径

绝对路径 + 文件名

## 位示图

就像一个表格，一个格是一位，一位对应一个物理块。这一位为0，则代表对应的物理块为空闲状态，如果为1，则代表对应的物理块为占用状态